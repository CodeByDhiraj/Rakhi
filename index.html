<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Happy Rakshabandhan üí´</title>

   <link rel="icon" type="/png" href="favicon.png" />

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>

  <style>
    :root {
      --bg1: #ff91a4;
      --bg2: #ffe3ec;
      --bg3: #ffd8f3;
      --card: #ffffff1f;
      --card-border: #ffffff40;
      --text: #101010;
      --muted: #454545;
      --accent: #ff2d75;
      --accent2: #8a2be2;
      --gold: #ffb703;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      font-family: Poppins, system-ui, Segoe UI, Roboto;
      color: var(--text);
      overflow: hidden;
    }

    /* ===== Background: gradient + parallax blobs ===== */
    .bg {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(1100px 600px at 10% 10%, var(--bg3), transparent),
        radial-gradient(900px 600px at 90% 20%, #ffeabf, transparent),
        linear-gradient(120deg, var(--bg1), var(--bg2) 45%, #fff 75%);
      filter: saturate(1.05);
    }

    .blob,
    .blob2,
    .blob3 {
      position: absolute;
      opacity: .35;
      filter: blur(42px);
      border-radius: 50%;
      animation: float 18s ease-in-out infinite;
    }

    .blob {
      left: -120px;
      bottom: -120px;
      width: 520px;
      height: 520px;
      background: conic-gradient(#ff85c4, #ffd4e5, #ff85c4)
    }

    .blob2 {
      right: -140px;
      top: -160px;
      width: 560px;
      height: 560px;
      background: conic-gradient(#b3e5ff, #e0ffff, #b3e5ff);
      animation-duration: 22s
    }

    .blob3 {
      left: 50%;
      top: 70%;
      transform: translateX(-50%);
      width: 480px;
      height: 480px;
      background: conic-gradient(#ffd1a3, #fff7d6, #ffd1a3);
      animation-duration: 26s
    }

    @keyframes float {
      50% {
        transform: translateY(-36px) translateX(16px) scale(1.06)
      }
    }

    /* ===== Center + glass card with tilt ===== */
    .center {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 18px;
      perspective: 1000px
    }

    .card {
      position: relative;
      width: min(980px, 94vw);
      max-height: 92vh;
      overflow: auto;
      /* vertical only */
      overflow-x: hidden;
      background: var(--card);
      backdrop-filter: blur(16px) saturate(1.25);
      border: 1px solid var(--card-border);
      border-radius: 28px;
      box-shadow: 0 28px 80px #00000024, inset 0 1px 0 #ffffff70;
      padding: 28px 22px 26px;
      transform-style: preserve-3d;
      transition: transform .18s ease;

      /* Themed scrollbar */
      scrollbar-width: thin;
      scrollbar-color: var(--accent) #ffffff55;
    }

    .card::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    .card::-webkit-scrollbar-track {
      background: #ffffff55;
      border-radius: 10px;
    }

    .card::-webkit-scrollbar-thumb {
      border-radius: 10px;
      background: linear-gradient(180deg, var(--accent), var(--accent2));
    }

    .card::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, var(--accent2), var(--accent));
    }

    /* Neon aura border only on second page */
    #surpriseCard.unlocked::before {
      content: "";
      position: absolute;
      inset: -2px;
      border-radius: 30px;
      pointer-events: none;
      background: conic-gradient(#ff2d7566, #8a2be266, #ffd16666, #ff2d7566);
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      padding: 2px;
      animation: spin 8s linear infinite;
      filter: blur(6px) saturate(1.3);
    }

    /* ===== Lock screen ===== */
    .lock {
      display: grid;
      gap: 16px;
      justify-items: center;
      text-align: center
    }

    .gift {
      font-size: 64px;
      filter: drop-shadow(0 6px 16px #ff2d7530);
      animation: bounce 1.8s infinite
    }

    @keyframes bounce {
      50% {
        transform: translateY(-6px)
      }
    }

    h1 {
      margin: 0 0 4px;
      font-size: clamp(26px, 4.3vw, 40px)
    }

    p.hint {
      margin: 0;
      color: var(--muted)
    }

    .hold {
      --p: 0;
      width: 128px;
      height: 128px;
      border-radius: 50%;
      background: conic-gradient(var(--accent) calc(var(--p)*1%), #e9e9e9 0);
      display: grid;
      place-items: center;
      cursor: pointer;
      user-select: none;
      margin-top: 8px;
      position: relative;
      transition: transform .2s ease;
    }

    .hold:active {
      transform: scale(.98)
    }

    .hold:before {
      content: "";
      position: absolute;
      inset: -10px;
      border-radius: inherit;
      background: radial-gradient(transparent 45%, #ff2d7533 56%, transparent 70%);
      filter: blur(6px);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      50% {
        transform: scale(1.06);
        opacity: .7
      }
    }

    .hold>span {
      display: grid;
      place-items: center;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid #f1f1f1;
      font-weight: 700;
      box-shadow: inset 0 0 0 1px #0000000a;
    }

    /* Mini version for lock screen */
    .credit-mini {
      margin-top: 8px;
      padding: 12px 10px 8px;
      font-size: 12px;
    }

    .credit-mini .credit-text {
      padding: 6px 12px;
    }

    .credit-mini .rakhi-badge {
      width: 28px;
      height: 28px;
      margin-right: 6px;
    }

    .credit-mini .thread-line {
      top: 6px;
      opacity: .35;
    }

    @supports (height: 100dvh) {
      .card {
        max-height: 92dvh;
      }

      .slide img {
        height: clamp(280px, 50dvh, 680px);
      }
    }

    /* iOS tap highlight off (buttons smoother) */
    .btn,
    .hold {
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }


    /* ===== Surprise view ===== */
    .surprise {
      display: grid;
      gap: 18px
    }

    .header {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      align-items: center;
      justify-content: space-between
    }

    .title {
      margin: 0;
      font-size: clamp(22px, 3.8vw, 36px);
      line-height: 1.1;
      background: linear-gradient(90deg, #ff3d7b, #ff7ab3, #ff3d7b);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: hueshift 8s linear infinite;
    }

    @keyframes hueshift {
      50% {
        filter: hue-rotate(25deg)
      }
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap
    }

    .btn {
      border: 1px solid #00000014;
      background: #fff;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all .18s;
      box-shadow: 0 6px 16px #00000010;
    }

    .btn:hover {
      transform: translateY(-1px) scale(1.01)
    }

    .hero {
      display: grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 18px;
      align-items: center
    }

    @media (max-width:860px) {
      .hero {
        grid-template-columns: 1fr
      }
    }

    /* Photo block with rotating rakhi ring + ken-burns + thread */
    .photo {
      display: grid;
      place-items: center;
      padding: 8px;
      transform-style: preserve-3d
    }

    .thread {
      position: absolute;
      width: 140%;
      height: 10px;
      left: -20%;
      top: 50%;
      background: repeating-linear-gradient(90deg, #c76c00 0 10px, #ffb703 10px 20px);
      filter: blur(.4px) saturate(1.2);
      transform: rotate(-10deg);
      opacity: .3;
    }

    .frame {
      width: min(380px, 78vw);
      aspect-ratio: 1/1;
      border-radius: 26px;
      overflow: hidden;
      position: relative;
      border: 3px solid #ffffff70;
      box-shadow: 0 18px 36px #00000020;
      mask: radial-gradient(circle at 50% 50%, #000 0, #000 0, transparent 0);
      animation: reveal 1.2s .1s ease-out forwards;
    }

    @keyframes reveal {
      to {
        mask: radial-gradient(circle at 50% 50%, #000 0, #000 120%, transparent 121%)
      }
    }

    .frame::before {
      /* rotating rakhi ring */
      content: "";
      position: absolute;
      inset: -10px;
      border-radius: 28px;
      background: conic-gradient(from 0deg, #ffd166 0 30%, #ff2d75 30% 60%, #8a2be2 60% 85%, #ffd166 85% 100%);
      -webkit-mask: radial-gradient(circle at 50% 50%, transparent 0 92%, #000 93% 100%);
      mask: radial-gradient(circle at 50% 50%, transparent 0 92%, #000 93% 100%);
      animation: spin 6s linear infinite;
      filter: drop-shadow(0 0 8px #ffb70388);
    }

    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }

    .photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      animation: ken 14s ease-in-out infinite
    }

    @keyframes ken {
      50% {
        transform: scale(1.06)
      }
    }

    /* Typewriter + subtle caret */
    .type {
      min-height: 96px;
      font-size: clamp(16px, 2.6vw, 20px);
      line-height: 1.7;
      position: relative
    }

    .type::after {
      content: "";
      width: 2px;
      height: 1.2em;
      background: #333;
      display: inline-block;
      margin-left: 4px;
      animation: blink 1s steps(1) infinite;
      vertical-align: -0.2em
    }

    @keyframes blink {
      50% {
        opacity: 0
      }
    }

    /* ===== Memories slider ‚Äî bigger box + hidden scrollbar ===== */
    .slider {
      position: relative;
      margin: 18px 0 16px;
      padding: 12px 12px 22px;
      /* extra bottom space for dots */
      border-radius: 24px;
      overflow: hidden;
      border: 1px solid #ffffff80;
      background: #ffffffb0;
      box-shadow: 0 14px 40px #00000014, inset 0 1px 0 #ffffff;
      mask-image: linear-gradient(transparent 0, #000 14px, #000 calc(100% - 14px), transparent 100%);
    }

    .track {
      display: flex;
      gap: 0;
      overflow: auto hidden;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;

      scrollbar-width: none;
      /* Firefox: hide */
    }

    .track::-webkit-scrollbar {
      height: 0;
      display: none;
    }

    /* WebKit: hide */

    .slide {
      min-width: 100%;
      scroll-snap-align: center
    }

    .slide img {
      display: block;
      width: 100%;
      height: clamp(320px, 50vh, 680px);
      /* taller slides */
      object-fit: cover;
      object-position: center;
      background: #f4f4f4;
      border-radius: 18px;
      box-shadow: 0 10px 24px #00000018;
    }

    /* 2nd image top-focused */
    .slide:nth-child(2) img {
      object-position: center top;
    }

    /* Dots (clickable) */
    .dots {
      display: flex;
      gap: 8px;
      justify-content: center;
      padding: 12px 6px 2px
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 10px;
      background: #0000002a;
      cursor: pointer;
      transition: transform .15s, background .15s;
    }

    .dot:hover {
      transform: scale(1.15)
    }

    .dot.active {
      background: linear-gradient(90deg, var(--accent), var(--accent2))
    }

    /* Hearts tap effect */
    .heart {
      position: fixed;
      pointer-events: none;
      font-size: 22px;
      animation: floatUp 1.2s ease forwards
    }

    @keyframes floatUp {
      0% {
        transform: translateY(0) scale(.8);
        opacity: .95
      }

      100% {
        transform: translateY(-60px) scale(1.4);
        opacity: 0
      }
    }

    .hidden {
      display: none
    }

    /* Fireworks canvas */
    #fw {
      position: fixed;
      inset: 0;
      pointer-events: none;
      mix-blend-mode: screen
    }

    /* Petals (emoji fall) */
    .petal {
      position: fixed;
      top: -40px;
      font-size: 24px;
      pointer-events: none;
      animation: fall 6s linear forwards
    }

    @keyframes fall {
      to {
        transform: translateY(110vh) rotate(180deg);
        opacity: .8
      }
    }

    /* Credit */
    /* --- Credit with Rakhi feel --- */
    .credit {
      position: relative;
      margin-top: 14px;
      text-align: center;
      font-size: 13px;
      color: #222;
      padding: 18px 12px 10px;
    }

    .credit .credit-text {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 999px;
      background: rgba(255, 255, 255, .85);
      box-shadow: 0 10px 30px #00000012, inset 0 1px 0 #ffffff;
      backdrop-filter: blur(6px);
    }

    .credit b {
      background: linear-gradient(90deg, var(--accent), var(--accent2), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      background-size: 200% 100%;
      animation: shimmer 6s linear infinite;
    }

    .credit .love {
      display: inline-block;
      margin-left: 4px;
      animation: beat 1.15s ease-in-out infinite;
    }

    /* little rotating rakhi badge */
    .credit .rakhi-badge {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      display: inline-grid;
      place-items: center;
      vertical-align: middle;
      background: radial-gradient(#fff 40%, #ffe9a3 75%);
      box-shadow: 0 4px 12px #00000014;
      margin-right: 8px;
      position: relative;
    }

    .credit .rakhi-badge::before {
      content: "";
      position: absolute;
      inset: -4px;
      border-radius: 50%;
      background: conic-gradient(#ffd166, #ff2d75, #8a2be2, #ffd166);
      -webkit-mask: radial-gradient(circle at 50% 50%, transparent 0 70%, #000 71% 100%);
      mask: radial-gradient(circle at 50% 50%, transparent 0 70%, #000 71% 100%);
      animation: spin 8s linear infinite;
      filter: drop-shadow(0 0 6px #ffb70388);
    }

    .credit .rakhi-badge::after {
      content: "üéÄ";
      font-size: 18px;
      transform: translateY(1px);
    }

    /* moving thread behind text */
    .credit .thread-line {
      position: absolute;
      left: 4%;
      right: 4%;
      top: 8px;
      height: 3px;
      background: repeating-linear-gradient(90deg, #c76c00 0 12px, #ffb703 12px 24px);
      opacity: .45;
      transform: rotate(-3deg);
      border-radius: 2px;
      background-size: 300px 3px;
      animation: threadMove 12s linear infinite;
    }

    /* animations */
    @keyframes shimmer {
      to {
        background-position: 200% 0;
      }
    }

    @keyframes beat {

      0%,
      100% {
        transform: scale(1)
      }

      50% {
        transform: scale(1.22)
      }
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes threadMove {
      from {
        background-position: 0 0;
      }

      to {
        background-position: 300px 0;
      }
    }
    .rakhi-anim{
  position:absolute; inset:0;
  display:grid; place-items:center;
  pointer-events:none; backdrop-filter: blur(1px) saturate(1.05);
}
.rakhi-anim svg{ max-width:min(520px, 86%); }

@keyframes slideHand{ 0%{transform:translateX(-30px)} 70%{transform:translateX(10px)} 100%{transform:translateX(0)} }
@keyframes growDial{ 0%{transform:translate(145px,96px) scale(0)} 100%{transform:translate(145px,96px) scale(1)} }
@keyframes show{ to{opacity:1} }
@keyframes hideAnim{ to{opacity:0} }

/* staged animation states applied by JS */
.rakhi-play #hand{ animation:slideHand .9s ease-out forwards }
.rakhi-play #dial{ animation:growDial .5s .7s ease-out forwards }
.rakhi-play #tR, .rakhi-play #tR2{ animation:show .3s 1.0s linear forwards }
.rakhi-play #knot{ animation:show .25s 1.25s linear forwards }
.rakhi-fade{ animation:hideAnim .6s 2.4s ease forwards }
.hidden{ display:none }
.photo{ position:relative } /* ensure overlay can sit on top */

  </style>
</head>

<body>
  <canvas id="fw"></canvas>
  <div class="bg">
    <div class="blob"></div>
    <div class="blob2"></div>
    <div class="blob3"></div>
  </div>

  <div class="center">
    <!-- LOCK -->
    <div id="lockCard" class="card lock" aria-live="polite">
      <div class="gift">üéÅ</div>
      <h1>Tap &amp; Hold to Unlock</h1>
      <p class="hint">Hold for <b>2 seconds</b> to reveal your surprise!</p>
      <div id="holdBtn" class="hold" aria-label="Hold to unlock"><span>Hold</span></div>
      <p class="hint">No spoilers ‚Äî unlock to reveal the magic ‚ú®</p>

    </div>

    <!-- CREDIT on LOCK -->
    <!-- CREDIT on LOCK -->
    <div id="lockCredit" class="credit credit-mini">
      <span class="thread-line" aria-hidden="true"></span>
      <span class="rakhi-badge" aria-hidden="true"></span>
      <span class="credit-text">
        Rakhi ke is pyaar bhare din par ‚Äî Designed &amp; Developed by
        <b>Dhiraj</b> for bhen <span class="love">üíñ</span>
      </span>
    </div>



    <!-- SURPRISE -->
    <div id="surpriseCard" class="card surprise hidden" role="dialog" aria-live="polite">
      <div class="header">
        <h2 class="title">üéÄ Happy Rakshabandhan, bhen!</h2>
        <div class="controls">
          <button class="btn" id="choosePhoto">Change Photo</button>
          <button class="btn" id="toggleMusic">Pause Music</button>
          <button class="btn" id="replay">Replay</button>
          <button class="btn" id="shareBtn">Share</button>
        </div>
      </div>

      <div class="hero">
        <div class="photo" id="tilt">
          <div class="thread"></div>
          <div class="frame">
            <img id="mainPhoto" src="images/sister.jpg" alt="Photo" />
          </div>
        </div>

        <!-- Rakhi tying overlay -->
<div id="rakhiAnim" class="rakhi-anim hidden" aria-hidden="true">
  <svg viewBox="0 0 320 200" width="100%" height="100%" preserveAspectRatio="xMidYMid meet">
    <!-- brother wrist -->
    <rect x="180" y="90" width="110" height="28" rx="14" fill="#f4c7a1"/>
    <!-- sister hand -->
    <g id="hand" transform="translate(0,0)">
      <rect x="28" y="86" width="90" height="36" rx="18" fill="#f0b58c"/>
      <circle cx="116" cy="104" r="14" fill="#f0b58c"/>
    </g>

    <!-- thread left -->
    <rect id="tL" x="112" y="101" width="66" height="4" rx="2" fill="#c76c00"/>
    <rect id="tL2" x="112" y="107" width="66" height="4" rx="2" fill="#ffb703"/>

    <!-- rakhi center -->
    <g id="dial" transform="translate(145,96) scale(0)">
      <circle r="12" fill="#ffd166" stroke="#ff2d75" stroke-width="3"/>
      <circle r="5" fill="#8a2be2"/>
    </g>

    <!-- thread right (over wrist) -->
    <rect id="tR" x="156" y="101" width="36" height="4" rx="2" fill="#c76c00" opacity="0"/>
    <rect id="tR2" x="156" y="107" width="36" height="4" rx="2" fill="#ffb703" opacity="0"/>

    <!-- knot -->
    <g id="knot" transform="translate(188,104)" opacity="0">
      <circle r="4" fill="#ff2d75"/>
      <path d="M0 0 L8 -6" stroke="#ff2d75" stroke-width="3" stroke-linecap="round"/>
      <path d="M0 0 L8 6" stroke="#ff2d75" stroke-width="3" stroke-linecap="round"/>
    </g>
  </svg>
</div>


        <div class="copy">
          <div id="typeText" class="type"></div>
        </div>
      </div>

      <div class="slider" id="memories">
        <div id="track" class="track">
          <div class="slide"><img src="images/mem1.jpg" alt="memory 1" loading="lazy"></div>
          <div class="slide"><img src="images/mem2.jpg" alt="memory 2" loading="lazy"></div>
          <div class="slide"><img src="images/mem3.jpg" alt="memory 3" loading="lazy"></div>
          <div class="slide"><img src="images/mem4.jpg" alt="memory 1" loading="lazy"></div>
          <div class="slide"><img src="images/mem5.jpg" alt="memory 2" loading="lazy"></div>
          <div class="slide"><img src="images/mem6.jpg" alt="memory 2" loading="lazy"></div>
        </div>
        <div class="dots" id="dots"></div>
      </div>

      <!-- Minimal equalizer (CSS animated) -->
      <div id="eq" style="display:flex;gap:6px;align-items:flex-end;height:26px;margin-top:6px;opacity:.9">
        <div style="width:6px;height:60%;background:#ff2d75;border-radius:4px;animation:bar 1s ease-in-out infinite">
        </div>
        <div
          style="width:6px;height:30%;background:#8a2be2;border-radius:4px;animation:bar .9s .1s ease-in-out infinite">
        </div>
        <div
          style="width:6px;height:70%;background:#ffb703;border-radius:4px;animation:bar 1.1s .2s ease-in-out infinite">
        </div>
        <div
          style="width:6px;height:40%;background:#ff2d75;border-radius:4px;animation:bar .95s .05s ease-in-out infinite">
        </div>
        <div
          style="width:6px;height:55%;background:#8a2be2;border-radius:4px;animation:bar 1.05s .12s ease-in-out infinite">
        </div>
      </div>

      <div class="credit">
        <span class="thread-line" aria-hidden="true"></span>
        <span class="rakhi-badge" aria-hidden="true"></span>
        <span class="credit-text">
          Rakhi ke is pyaar bhare din par ‚Äî Designed &amp; Developed by
          <b>Dhiraj</b> for bhen <span class="love">üíñ</span>
        </span>

      </div>

    </div>
  </div>

  <audio id="music" src="song.mp3" preload="auto" loop></audio>
  <style>
    @keyframes bar {
      50% {
        transform: scaleY(1.6)
      }
    }
  </style>

  <script>
    /* ===== Tilt effect ===== */
    const anyCard = document.querySelector('.card');
const isTouch = window.matchMedia('(pointer: coarse)').matches;

if (!isTouch) {
  document.addEventListener('mousemove', (e) => {
    const r = anyCard.getBoundingClientRect();
    const x = (e.clientX - (r.left + r.width / 2)) / r.width;
    const y = (e.clientY - (r.top + r.height / 2)) / r.height;
    anyCard.style.transform = `rotateY(${x * 6}deg) rotateX(${(-y) * 6}deg)`;
  });
  document.addEventListener('mouseleave', () => anyCard.style.transform = 'rotateY(0) rotateX(0)');
}

    /* ===== Unlock (tap & hold 2s) ===== */
    const holdBtn = document.getElementById('holdBtn');
    let interval, progress = 0;
    const LOCK_MS = 2000;
    function startHold() {
      progress = 0;
      interval = setInterval(() => {
        progress += 100 / (LOCK_MS / 40);
        holdBtn.style.setProperty('--p', progress);
        if (progress >= 100) { finishUnlock() }
      }, 40);
    }
    function endHold() { clearInterval(interval); holdBtn.style.setProperty('--p', 0); }
    function finishUnlock() {
      clearInterval(interval);
      document.getElementById('lockCard').classList.add('hidden');
      document.getElementById('lockCredit')?.classList.add('hidden');
      const sc = document.getElementById('surpriseCard');
      sc.classList.remove('hidden'); sc.classList.add('unlocked');
      playMusic(); confettiBurst(); fireworks(4); typeWriter(MSG); startPetals();
    }
    ['mousedown', 'touchstart'].forEach(e => holdBtn.addEventListener(e, startHold, { passive: true }));
    ['mouseup', 'mouseleave', 'touchend', 'touchcancel'].forEach(e => holdBtn.addEventListener(e, endHold));

    /* ===== Music ===== */
    const music = document.getElementById('music');
    const toggleBtn = document.getElementById('toggleMusic');
    function playMusic() { music.currentTime = 0; music.play().catch(() => { }); toggleBtn.textContent = 'Pause Music'; }
    toggleBtn.addEventListener('click', () => {
      if (music.paused) { music.play(); toggleBtn.textContent = 'Pause Music'; }
      else { music.pause(); toggleBtn.textContent = 'Play Music'; }
    });

    /* ===== Confetti ===== */
    const jsConfetti = new JSConfetti();
    function confettiBurst() {
      jsConfetti.addConfetti({ emojis: ['üéâ', 'üíñ', 'ü™î', '‚ú®', 'üéÄ', 'ü•≥'], emojiSize: 28, confettiNumber: 180 });
      setTimeout(() => jsConfetti.addConfetti(), 650);
    }

    /* ===== Hearts ===== */
    document.addEventListener('click', (e) => {
      if (document.getElementById('surpriseCard').classList.contains('hidden')) return;
      const h = document.createElement('div');
      h.className = 'heart'; h.textContent = 'üíñ';
      h.style.left = (e.clientX - 10) + 'px'; h.style.top = (e.clientY - 10) + 'px';
      document.body.appendChild(h);
      setTimeout(() => h.remove(), 1200);
    });

    /* ===== Typewriter ===== */
    const MSG = "Bhen, tu hamesha khush aur sehatmand reh‚Äîmain hamesha tere saath hoon. ü§ç Happy Rakshabandhan üíñ";

    const typeEl = document.getElementById('typeText');
    function typeWriter(text, i = 0) {
      if (i === 0) typeEl.textContent = '';
      if (i < text.length) {
        typeEl.textContent += text.charAt(i);
        setTimeout(() => typeWriter(text, i + 1), 22);
      }
    }

    /* ===== Photo picker ===== */
    const fileBtn = document.getElementById('choosePhoto');
    const imgEl = document.getElementById('mainPhoto');
    fileBtn.addEventListener('click', () => {
      const input = document.createElement('input');
      input.type = 'file'; input.accept = 'image/*';
      input.onchange = e => {
        const file = e.target.files[0]; if (!file) return;
        const r = new FileReader();
        r.onload = () => { imgEl.src = r.result; localStorage.setItem('rakhi-photo', r.result); };
        r.readAsDataURL(file);
      };
      input.click();
    });
    const saved = localStorage.getItem('rakhi-photo'); if (saved) imgEl.src = saved;

    /* ===== Replay + Share ===== */
    document.getElementById('replay').addEventListener('click', () => {
      confettiBurst(); fireworks(4); playMusic(); typeWriter(MSG, 0);
    });
    document.getElementById('shareBtn').addEventListener('click', async () => {
      const url = location.href, text = "Happy Rakshabandhan! üíù";
      if (navigator.share) { try { await navigator.share({ title: 'Rakhi Surprise', text, url }); } catch { } }
      else { navigator.clipboard.writeText(url); alert("Link copied."); }
    });

    /* ===== Slider (auto + clickable dots + hide if images missing) ===== */
    const slider = document.getElementById('memories');
    const track = document.getElementById('track');
    const dotsWrap = document.getElementById('dots');
    let dots = [];
    let idx = 0;

    function buildDots() {
      dotsWrap.innerHTML = '';
      [...track.querySelectorAll('.slide')].forEach((_, i) => {
        const d = document.createElement('span');
        d.className = 'dot' + (i === 0 ? ' active' : '');
        d.dataset.i = i;
        d.addEventListener('click', () => {
          clearInterval(auto); go(i);
          auto = setInterval(() => go(idx + 1), 3000);
        });
        dotsWrap.appendChild(d);
      });
      dots = [...dotsWrap.children];
    }
    function validateSlides() {
      const imgs = [...track.querySelectorAll('img')];
      if (!imgs.length) { slider?.classList.add('hidden'); return; }
      imgs.forEach((img, i) => {
        img.addEventListener('error', () => {
          img.closest('.slide')?.remove();
          buildDots();
          if (track.children.length === 0) slider?.classList.add('hidden');
        });
      });
    }
    validateSlides(); buildDots();

    function go(i) {
      if (!track.children.length) return;
      idx = (i + track.children.length) % track.children.length;
      const slideW = track.getBoundingClientRect().width;
      track.scrollTo({ left: slideW * idx, behavior: 'smooth' });
      dots.forEach((d, j) => d.classList.toggle('active', j === idx));
    }
    let auto = setInterval(() => go(idx + 1), 3000);
    track.addEventListener('pointerdown', () => clearInterval(auto));

    /* ===== Fireworks (canvas) ===== */
    const c = document.getElementById('fw'), ctx = c.getContext('2d'); let fwAnim;
    function sizeCanvas() { c.width = innerWidth; c.height = innerHeight }
    sizeCanvas(); addEventListener('resize', sizeCanvas);
    const particles = [];
    function boom(x, y, color, count = 90) {
      for (let i = 0; i < count; i++) {
        const a = Math.random() * Math.PI * 2, s = Math.random() * 5 + 2;
        particles.push({ x, y, vx: Math.cos(a) * s, vy: Math.sin(a) * s, life: 80, color });
      }
    }
    function fireworks(times = 3) {
      for (let i = 0; i < times; i++) {
        setTimeout(() => boom(Math.random() * innerWidth, innerHeight * 0.35 + Math.random() * innerHeight * 0.4,
          `hsl(${Math.random() * 360},85%,60%)`, 100), i * 260);
      }
      cancelAnimationFrame(fwAnim); renderFW();
    }
    function renderFW() {
      ctx.globalCompositeOperation = 'lighter';
      ctx.fillStyle = 'rgba(0,0,0,0.18)'; ctx.fillRect(0, 0, c.width, c.height);
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx; p.y += p.vy; p.vy += 0.04; p.life--;
        ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
        ctx.fillStyle = p.color; ctx.fill();
        if (p.life <= 0) particles.splice(i, 1);
      }
      fwAnim = requestAnimationFrame(renderFW);
    }
    /* Click fireworks on second page */
    document.addEventListener('click', (ev) => {
      if (!document.getElementById('surpriseCard').classList.contains('hidden')) {
        boom(ev.clientX, ev.clientY, `hsl(${Math.random() * 360},85%,60%)`, 60);
      }
    });

    /* ===== Falling petals (emoji) ===== */
    let petalTimer;
    function startPetals() {
      clearInterval(petalTimer);
      petalTimer = setInterval(() => {
        const p = document.createElement('div');
        p.className = 'petal';
        p.textContent = Math.random() < 0.5 ? 'üå∏' : 'üíÆ';
        p.style.left = Math.random() * 100 + 'vw';
        p.style.animationDuration = 5 + Math.random() * 3 + 's';
        p.style.transform = `rotate(${Math.random() * 60 - 30}deg)`;
        document.body.appendChild(p);
        setTimeout(() => p.remove(), 8000);
      }, 600);
    }
  </script>
</body>

</html>